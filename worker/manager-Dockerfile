FROM python:3.13-slim-bookworm
LABEL zimfarm=true
LABEL org.opencontainers.image.source=https://github.com/openzim/zimfarm

ENV TASK_WORKER_IMAGE=""
ENV DNSCACHE_IMAGE=""
ENV UPLOADER_IMAGE=""
ENV CHECKER_IMAGE=""
ENV MONITOR_IMAGE=""

ENV WEB_API_URI=https://api.farm.openzim.org/v2
ENV SOCKET_URI=tcp://tcp.farm.openzim.org:32029
ENV WORKDIR=/data

VOLUME /var/run/docker.sock
VOLUME /data

WORKDIR /usr/src

COPY pyproject.toml README.md ./app/
COPY src/zimfarm_worker/__about__.py ./app/src/zimfarm_worker/__about__.py
RUN pip install --no-cache-dir ./app

COPY src ./app/src

RUN pip install --no-cache-dir ./app  \
    && rm -rf ./app/src \
    && rm ./app/pyproject.toml \
    && rm ./app/README.md

CMD ["worker-manager"]
